<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <changeSet id="add-new-column-enable_critical_chain_support" author="jaragunde">
        <comment>Add new column enable_critical_chain_support with default value FALSE to configuration table</comment>
        <addColumn tableName="configuration">
            <column name="enable_critical_chain_support" type="BOOLEAN" />
        </addColumn>
        <addDefaultValue tableName="configuration" columnName="enable_critical_chain_support"
            defaultValue="FALSE" />
    </changeSet>

    <changeSet id="replace-column-limited_resource-with-resource_type" author="jaragunde">
        <comment>Replace column limited_resource with resource_type in resource table</comment>
        <addColumn tableName="resource">
            <column name="resource_type" type="VARCHAR(64)"/>
        </addColumn>
        <update tableName="resource">
            <column name="resource_type" value="NON_LIMITING_RESOURCE"/>
            <where>limited_resource = false</where>
        </update>
        <update tableName="resource">
            <column name="resource_type" value="LIMITING_RESOURCE"/>
            <where>limited_resource = true</where>
        </update>
        <addNotNullConstraint tableName="resource" columnName="resource_type" />
        <dropColumn tableName="resource" columnName="limited_resource"/>
    </changeSet>

</databaseChangeLog>
